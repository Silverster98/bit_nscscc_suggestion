# 针对参加龙芯杯的若干建议

> 为了更好地帮助后来的同学参加龙芯杯，草拟了这份建议，望对后来人有所帮助。

## 常用链接
- [龙芯杯官网](http://www.nscscc.org)：大赛官方网站，其中可以获取跟大赛相关信息以及相关资料。
- [2019 NSCSCC 清华特等奖作品开源代码仓库](https://github.com/trivialmips/)：第三届龙芯杯特等奖参赛作品。
- [2018 NSCSCC 北理工参赛作品开源代码仓库](https://github.com/bit-mips)：第二届北理工参赛作品
- [2019 北理工2队参赛队员总结](https://github.com/Silverster98/bitmips2019/tree/master/summary)：第三届北理工2队参赛队员王赞和范志鹏的总结。
- [2018 北理工参赛队员总结](https://github.com/bit-mips/about-contest/blob/master/%E7%B3%BB%E7%BB%9F%E8%83%BD%E5%8A%9B%E5%9F%B9%E5%85%BB%E5%A4%A7%E8%B5%9B%E5%8F%82%E8%B5%9B%E5%BF%83%E5%BE%97%E6%80%BB%E7%BB%93.pdf)：第二届北理工参赛队员朱威浦和江学谦的总结。
- [ProcessOn](https://www.processon.com) ：这是一个可以多人在线协作的作图工具，包括支持流程图、思维导图、原型图、UML、网络拓扑图、组织结构图和电路图等。在 CPU 设计的过程中可以用来设计 CPU 架构图。
- [draw.io](https://www.draw.io)：同 ProcessOn 的一个工具。

## 大赛概况

### 1. 大赛核心任务说明

龙芯杯的全称是全国大学生系统能力培养大赛，这个比赛是要求参赛学生具有一定的计算机系统设计能力，所谓的计算机系统就是整个计算机硬件和软件系统。

大赛分为两个阶段：

- 初赛阶段：初赛阶段要求参赛选手完成一个 MIPS CPU 的设计，需要实现 MIPS 指令集架构的一个子集，共 57 条指令，同时要实现部分异常处理和协处理器 CP0 中的部分寄存器。CPU 的实现是通过 HDL（verilog、VHDL、system verilog 等）编程实现，并在 FPGA 上下板运行。大赛会提供相关的软件对参赛队伍的 CPU 的功能和性能进行测试。首先要功能测试通过才会再去进行性能测试。因此，参赛队伍需要在功能测试通过的前提下尽可能的提高性能测试。初赛的评比结果决定进入决赛的队伍，目前基本就是根据各参赛队伍 CPU 性能来判定，性能越高进入决赛的几率就越大。

- 决赛阶段：在初赛阶段基本都是硬件相关工作，到决赛阶段主要涉及到软件工作，决赛阶段要求参赛队完成一个拥有软件和硬件的计算机系统的作品，基本上就是需要有一个软件能够跑在初赛阶段所开发的 CPU 上。这个软件可以自己写也可以使用大赛提供的软件，软件可以是一些嵌入式软件，也可以是操作系统如 ucore、 linux，一般参赛队都会选择跑大赛提供的 pmon、ucore、linux。决赛最终成绩由三部分组成：
		1. 再次测试的 CPU 性能水平（40%）。
		2. 自定义指令答题，决赛会让参赛队在现场实现一条指定指令（20%）。
		3. 系统展示和答辩，系统展示就是展示 CPU 及其运行的软件，当然跑的软件越复杂（如 Linux）分数越高，还会有一个答辩（40%）。

### 2. 大赛获奖形势说明

必须要说明的是：**大赛形势非常严峻！**

北理工在第二届开始参赛，第二届只有一支参赛队伍最终进入了决赛并拿到了三等奖，第三届参赛队伍有两支，但都没有进入决赛。

第二届进入决赛的参赛队伍都完成了 CPU 的功能测试，并且最后一名参赛队伍的性能测试分数为 0.885，本届我校一支参赛队伍的分数为 5.909。第三届进入决赛的参赛队伍也都完成了 CPU 的功能测试，最后一名参赛队伍的性能测试分数为 24.539，我校两支参赛队伍的分数分别为 14.0、7.0。因此，可以说想要进入决赛是越来越难（如果改赛制可能就不一定了）。同时，进入决赛想要拿一个奖项也很难。龙芯杯的特等奖和一等奖的归属基本上就是清华、国科大、西工大这三所学校（但今年又冒出北邮这个"黑马"拿了一等奖）。然后二等奖就是华科、南航、北航、哈工大等学校。三等奖基本就是其他学校和上面这些学校的二队瓜分。

我理该何去何从？

**参加这个比赛之前必须做好不能获奖的心理准备。**

## 备赛时间节点安排建议

首先分析我理的情况：以第三届为参考，在 10 月份左右，陆老师会开始召集大三学生参加这个比赛，在第二年的 8 月初即开始提交初赛作品，因此总共会有近 10 个月的准备时间。因为我校的计算机组成原理和操作系统开在大三上，体系结构和汇编开在大三下，所以 10 月份参赛的时候基本上没有一点基础，顶多也就在数字逻辑课上学了一点简单的 verilog 语法。同时在大三一学年还有相关课程，因此在平时可能时间并不多。

针对我理的情况，对参赛队伍提供一下的时间节点安排的参考：

- 大三上
  - 学期中期前：完成单周期 CPU 的设计，能够下板运行，对 verilog 有进一步的认识与了解，对 MIPS 架构有一定程度的了解。
  - 学期末之前：完成多周期 CPU 的设计（对于多周期可以不花费较多时间）。重点学习流水线设计，理解流水线中的相关概念，争取对流水线的整个架构能够有一个清晰认识。
- 寒假
  - 个人完成流水线的一个简单设计，在下学期开始组队合作写流水线。让每个人都实现一个简单流水线的目的在于能够让每个人都能把握流水线中的设计要点，这样在小组合作的时候不至于成员相互之间不知所云。
- 大三下
  - 学期开始进行组队，在学期中之前：小组能够完成一个流水线 CPU，可以下板运行通过功能测试与性能测试，但此时性能肯定很低。
  - 学期末之前：小组对完成 CPU 的 cache 设计，要写进决赛必须完成 cache 实现，cache 对 CPU 性能提升有至关重要的作用，并且不能使用 system_cache ip 核（使用这个 ip 核性能提高不会太多）。另外，cache的实现中请不要使用reg直接定义，这样会浪费大量的LUT和FF资源，导致布线失败。请参考loongson官方提供的cache手册，实现bram结构的cache。特别地，cache的实现需要精细的设计，如果想进入决赛，需要cache hit时最多每两个周期读取一条指令，且主频要比较高。建议花时间实现一个无互锁的流水线结构，即cache命中时IPC=1，这样可以确保进入决赛，这也是mips(microprocessor without interlocked piped stages architecture)设计的愿意所在。
- 暑假
  - 假定到暑假时完成以上的设计，并且可以确定当前分数能够进入决赛，此时需要对 CPU 进一步扩充以支持操作系统运行，即增加 TLB 模块以及增加若干条运行操作系统所需的指令，同时还需完成一个 soc 的设计。此时还需开始软件部分的工作，需要修改软件相关代码，以支持软件在小组所实现的 CPU 上运行，对软件调试，可以先跑 pmon，再跑 ucore，最后上 linux。
  - 若到暑假时觉得 CPU 性能还有欠缺，那就尽可能地先提高 CPU 的性能。之后再进行上述工作。

**注：以上时间节点安排仅供参考，可以灵活调整**

## 其他

### 1. 第二届决赛入围名单：

| 序号 | 队伍名称                   | 功能分  | 性能分 |
| ---- | -------------------------- | ------- | ------ |
| 1    | 西北工业大学 2 队          | 100.000 | 71.173 |
| 2    | 西北工业大学 1 队          | 100.000 | 70.773 |
| 3    | 中国科学院大学 1 队        | 100.000 | 69.289 |
| 4    | 北京航空航天大学 1 队      | 100.000 | 49.124 |
| 5    | 南京大学 2 队              | 100.000 | 41.142 |
| 6    | 华中科技大学 1 队          | 100.000 | 40.671 |
| 7    | 河北大学 1 队              | 100.000 | 40.150 |
| 8    | 清华大学 1 队              | 100.000 | 36.760 |
| 9    | 济南大学 1 队              | 100.000 | 36.312 |
| 10   | 河北大学 2 队              | 100.000 | 35.258 |
| 11   | 北京航空航天大学 2 队      | 100.000 | 34.705 |
| 12   | 华中科技大学 2 队          | 100.000 | 29.215 |
| 13   | 重庆大学 2 队              | 100.000 | 19.162 |
| 14   | 重庆大学 1 队              | 100.000 | 16.425 |
| 15   | 天津大学队                 | 100.000 | 12.196 |
| 16   | 中国科学院大学 2 队        | 100.000 | 10.288 |
| 17   | 北京理工大学 1 队          | 100.000 | 5.909  |
| 18   | 东北大学 1 队              | 100.000 | 4.755  |
| 19   | 东北大学 2 队              | 100.000 | 4.692  |
| 20   | 南京理工大学 2 队          | 100.000 | 1.389  |
| 21   | 北京科技大学 1 队          | 100.000 | 1.121  |
| 22   | 武汉大学队                 | 100.000 | 0.972  |
| 23   | 南开大学 1 队              | 100.000 | 0.966  |
| 24   | 哈尔滨工业大学（威海）1 队 | 100.000 | 0.899  |
| 25   | 南京航空航天大学           | 100.000 | 0.885  |

### 2. 第三届决赛入围名单

| 序号 | 队伍名称               | 学校                   | 功能分  | 性能分 | 频率 MHz |
| ---- | ---------------------- | ---------------------- | ------- | ------ | -------- |
| 1    | 真香队                 | 中国科学院大学         | 100.000 | 71.441 | 110      |
| 2    | 毕业就去送快递         | 北京邮电大学           | 100.000 | 61.376 | 100      |
| 3    | Hypothetic CPU         | 哈尔滨工业大学（威海） | 100.000 | 60.256 | 120      |
| 4    | HITSZers               | 哈尔滨工业大学（深圳） | 100.000 | 52.652 | 109      |
| 5    | 编程是一件很危险的事情 | 清华大学               | 100.000 | 52.157 | 80       |
| 6    | 天骄四连               | 南京理工大学           | 100.000 | 48.565 | 89       |
| 7    | ECNUCoder              | 华东师范大学           | 100.000 | 47.099 | 80       |
| 8    | 河北大学 2 队          | 河北大学               | 100.000 | 46.18  | 110      |
| 9    | 北京航空航天大学 2 队  | 北京航空航天大学       | 100.000 | 43.864 | 82       |
| 10   | 河北大学 1 队          | 河北大学               | 100.000 | 43.468 | 83       |
| 11   | 西工大 1 队            | 西北工业大学           | 100.000 | 39.92  | 65       |
| 12   | 北京航空航天大学 1 队  | 北京航空航天大学       | 100.000 | 39.862 | 87       |
| 13   | Cat                    | 南京理工大学           | 100.000 | 39.029 | 70       |
| 14   | HITSZ-MIPSbuilder      | 哈尔滨工业大学（深圳） | 100.000 | 38.982 | 95       |
| 15   | 沙坪坝技校一队         | 重庆大学               | 100.000 | 35.969 | 70       |
| 16   | 别急稳住我们能赢       | 华中科技大学           | 100.000 | 32.588 | 60       |
| 17   | 南航 1 队              | 南京航空航天大学       | 100.000 | 32.113 | 94       |
| 18   | NKU 日新队             | 南开大学               | 100.000 | 30.589 | 85       |
| 19   | 西工大 2 队            | 西北工业大学           | 100.000 | 28.91  | 50       |
| 20   | 天津大学 2 队          | 天津大学               | 100.000 | 26.35  | 60       |
| 21   | NKU 月异队             | 南开大学               | 100.000 | 24.539 | 110      |

### 建议人列表

|                  姓名                   |            介绍            |
| :-------------------------------------: | :------------------------: |
| **王赞** | 北理工第三届龙芯杯参赛队员 |
| **范志鹏**| 北理工第三届龙芯杯参赛队员 |
